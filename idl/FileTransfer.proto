syntax="proto3";
package file_transfer;

message Message {
    oneof content {
        FileListRequest file_list_request = 1;
        FileTransferRequest file_transfer_request = 2;
        ClientReady client_ready = 3;
        FileTransferError file_transfer_error = 4;
        FileList file_list = 5;
        FileInfo file_info = 6;
        FileChunk file_chunk = 7;
        FileTransferComplete file_transfer_complete = 8;
        Error error = 9;
    }
}

// client to server

message FileListRequest {
}
message FileTransferRequest {
    string name = 1;
}
message ClientReady {
    uint32 id = 1; // identifier for the file transfer session
}

// server to client

message FileList {
    message File {
        string name = 1;
        int64 size = 2;
    }
    repeated File files = 1;
}

message FileInfo {
    uint32 id = 1; // identifier for the file transfer session
    string name = 2;
    int64 size = 3;
}
message FileChunk {
    uint32 id = 1; // identifier for the file transfer session
    bytes data = 2;
    bool last_chunk = 3;
}
message FileTransferComplete {
    uint32 id = 1; // identifier for the file transfer session
}

// common
enum ErrorCode {
    NOT_FOUND = 0;
    INTERNAL = 1;        
}

// This is for general errors not specific to a file transfer session
message Error {
    ErrorCode code = 1;
    string message = 2;
}

// This is for errors specific to a file transfer session
// It triggers a reset of that session
message FileTransferError {
    uint32 id = 1; // identifier for the file transfer session
    ErrorCode code = 2;
    string message = 3;
}


/*
File listing sequence:
1. client -> server: FileListRequest
2. server -> client: FileList

File transfer sequence:
1. client -> server: FileTransferRequest
2. server -> client: FileInfo
3. client -> server: ClientReady
4. server -> client: FileChunk* (repeated)
6. server -> client: FileTransferComplete

if an error occurs:
1. server -> client: FileTransferError
server and client reset the session and can start over
1. client -> server: FileTransferError
server and client reset the session and can start over
*/